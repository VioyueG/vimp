<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Types of VIMs • vimp</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Types of VIMs">
<meta property="og:description" content="vimp">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">vimp</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/introduction-to-vimp.html">Introduction to `vimp`</a>
    </li>
    <li>
      <a href="../articles/precomputed-regressions.html">Using precomputed regression function estimates in `vimp`</a>
    </li>
    <li>
      <a href="../articles/types-of-vims.html">Types of VIMs</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/bdwilliamson/vimp/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="types-of-vims_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Types of VIMs</h1>
                        <h4 class="author">Brian D. Williamson</h4>
            
            <h4 class="date">2020-09-16</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/bdwilliamson/vimp/blob/master/vignettes/types-of-vims.Rmd"><code>vignettes/types-of-vims.Rmd</code></a></small>
      <div class="hidden name"><code>types-of-vims.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st"><a href="https://bdwilliamson.github.io/vimp">"vimp"</a></span>)
<span class="co">#&gt; vimp version 2.1.1: Perform Inference on Algorithm-Agnostic Variable Importance</span>
<span class="co">#&gt; Package created on 2020-09-16</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st"><a href="https://github.com/ecpolley/SuperLearner">"SuperLearner"</a></span>)
<span class="co">#&gt; Loading required package: nnls</span>
<span class="co">#&gt; Super Learner</span>
<span class="co">#&gt; Version: 2.0-26</span>
<span class="co">#&gt; Package created on 2019-10-27</span>
</pre></div>
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>In the main vignette (<a href="introduction_to_vimp.html">“Introduction to <code>vimp</code>”</a>), I discussed variable importance defined using R-squared. I also mentioned that all of the analyses were carried out using a <em>condititonal</em> variable importance measure. In this document, I will discuss all three types of variable importance that may be computed using <code>vimp</code>.</p>
<p>In general, I define variable importance as a function of the true population distribution (denoted by <span class="math inline">\(P_0\)</span>) and a predictiveness measure <span class="math inline">\(V\)</span> – large values of <span class="math inline">\(V\)</span> are assumed to be better. Currently, the measures <span class="math inline">\(V\)</span> implemented in <code>vimp</code> are <span class="math inline">\(R^2\)</span>, classification accuracy, area under the receiver operating characteristic curve (AUC), and deviance. For a fixed function <span class="math inline">\(f\)</span>, the predictiveness is given by <span class="math inline">\(V(f, P)\)</span>, where large values imply that <span class="math inline">\(f\)</span> is a good predictor of the outcome. The best possible prediction function <span class="math inline">\(f_0\)</span>, is the <em>oracle</em> model – i.e., the prediction function that I would use if I had access to the distribution <span class="math inline">\(P_0\)</span>. Often, <span class="math inline">\(f_0\)</span> is the true conditional mean (e.g., for <span class="math inline">\(R^2\)</span>). Then the <em>total oracle predictiveness</em> can be defined as <span class="math inline">\(V(f_0, P_0)\)</span>. This is the best possible value of predictiveness.</p>
<p>I define variable importance measures (VIMs) as contrasts in oracle predictivness. The oracle models that I plug in determine what type of variable importance is being considered, as I outline below. For the remainder of this document, suppose that I have <span class="math inline">\(p\)</span> variables, and an index set <span class="math inline">\(s\)</span> of interest (containing some subset of the <span class="math inline">\(p\)</span> variables). Throughout this document, I will use the South African heart disease study data <span class="citation">[@hastie2009]</span> to illustrate how each VIM may be estimated (freely available from the <a href="https://web.stanford.edu/~hastie/ElemStatLearn/datasets/SAheart.data">Elements of Statistical Learning website</a>; more information about these data is available <a href="https://web.stanford.edu/~hastie/ElemStatLearn/datasets/SAheart.info.txt">here</a>). Throughout, I will also use a simple library of learners for the Super Learner (this is for illustration only; in practice, I suggest using a large library of learners, as outlined in the <a href="introduction_to_vimp.html">main vignette</a>).</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="co">## read in the data from the Elements website</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"RCurl"</span>)
<span class="kw">heart_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(text = <span class="fu"><a href="https://rdrr.io/pkg/RCurl/man/getURL.html">getURL</a></span>(<span class="st">"http://web.stanford.edu/~hastie/ElemStatLearn/datasets/SAheart.data"</span>), header = <span class="fl">TRUE</span>, stringsAsFactors = <span class="fl">FALSE</span>)
<span class="co">## minor data cleaning</span>
<span class="kw">heart</span> <span class="op">&lt;-</span> <span class="kw">heart_data</span>[, <span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(<span class="kw">heart_data</span>)[<span class="fl">2</span>]]
<span class="kw">heart</span><span class="op">$</span><span class="kw">famhist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="kw">heart</span><span class="op">$</span><span class="kw">famhist</span> <span class="op">==</span> <span class="st">"Present"</span>, <span class="fl">1</span>, <span class="fl">0</span>)
<span class="kw">learners.2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"SL.ranger"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">12345</span>)
</pre></div>
</div>
<div id="conditional-vims" class="section level2">
<h2 class="hasAnchor">
<a href="#conditional-vims" class="anchor"></a>Conditional VIMs</h2>
<p>The <em>reduced oracle predictiveness</em> is defined as <span class="math inline">\(V(f_{0,-s}, P_0)\)</span>, where <span class="math inline">\(f_{0,-s}\)</span> is the best possible prediction function that <em>does not use the covariates with index in <span class="math inline">\(s\)</span></em>. Then the conditional VIM is defined as <span class="math display">\[V(f_0, P_0) - V(f_{0,-s}, P_0).\]</span> This is the measure of importance that I estimated in the <a href="introduction_to_vimp.html">main vignette</a>. To estimate the conditional VIM for family history of heart disease, I can use the following code:</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="co"># note the use of a small V and a small number of SL folds, for illustration only</span>
<span class="kw">V</span> <span class="op">&lt;-</span> <span class="fl">2</span>
<span class="kw">sl_cvcontrol</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(V = <span class="fl">2</span>)
<span class="kw">fam_vim_cond</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vimp_rsquared.html">vimp_rsquared</a></span>(Y = <span class="kw">heart</span><span class="op">$</span><span class="kw">chd</span>, X = <span class="kw">heart</span>[, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span>(<span class="kw">heart</span>)], indx = <span class="fl">5</span>, SL.library = <span class="kw">learners.2</span>, na.rm = <span class="fl">TRUE</span>, env = <span class="fu"><a href="https://rdrr.io/r/base/environment.html">environment</a></span>(), V = <span class="kw">V</span>, cvControl = <span class="kw">sl_cvcontrol</span>)
<span class="co">#&gt; Loading required namespace: ranger</span>
<span class="co">#&gt; Warning in cv_vim(Y = Y, X = X, f1 = f1, f2 = f2, indx = indx, V = V, weights =</span>
<span class="co">#&gt; weights, : Original estimate &lt; 0; returning zero.</span>
</pre></div>
</div>
<div id="marginal-vims" class="section level2">
<h2 class="hasAnchor">
<a href="#marginal-vims" class="anchor"></a>Marginal VIMs</h2>
<p>The <em>marginal oracle predictiveness</em> is defined as <span class="math inline">\(V(f_{0,s}, P_0)\)</span>, where <span class="math inline">\(f_{0,s}\)</span> is the best possible prediction function that <em>only uses the covariates with index in <span class="math inline">\(s\)</span></em>. The <em>null oracle predictiveness</em> is defined as <span class="math inline">\(V(f_{0, \emptyset}, P_0)\)</span>, where <span class="math inline">\(f_{0,\emptyset}\)</span> is the best possible prediction function that <em>uses no covariates</em> (i.e., is fitting the mean). Then the marginal VIM is defined as <span class="math display">\[V(f_{0,s}, P_0) - V(f_{0,\emptyset}, P_0).\]</span> To estimate the marginal VIM for family history of heart disease, I can use the following code:</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="co"># note the use of a small V and a small number of SL folds, for illustration only</span>
<span class="kw">fam_vim_marg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vimp_rsquared.html">vimp_rsquared</a></span>(Y = <span class="kw">heart</span><span class="op">$</span><span class="kw">chd</span>, X = <span class="kw">heart</span>[, <span class="fl">5</span>, drop = <span class="fl">FALSE</span>], indx = <span class="fl">1</span>, SL.library = <span class="kw">learners.2</span>, na.rm = <span class="fl">TRUE</span>, env = <span class="fu"><a href="https://rdrr.io/r/base/environment.html">environment</a></span>(), V = <span class="kw">V</span>, cvControl = <span class="kw">sl_cvcontrol</span>)
</pre></div>
</div>
<div id="shapley-vims" class="section level2">
<h2 class="hasAnchor">
<a href="#shapley-vims" class="anchor"></a>Shapley VIMs</h2>
<p>The Shapley population VIM (SPVIM) generalizes the marginal and conditional VIMs by averaging over all possible subsets. More specifically, the SPVIM for feature <span class="math inline">\(j\)</span> is given by <span class="math display">\[\sum_{s \subseteq \{1,\ldots,p\} \setminus \{j\}} \binom{p-1}{\lvert s \rvert}^{-1}\{V(f_{0, s \cup \{j\}}, P_0)) - V(f_{0,s}, P_0)\};\]</span> this is the average gain in predictiveness from adding feature <span class="math inline">\(j\)</span> to each possible grouping of the other features. To estimate the SPVIM for family history of heart disease, I can use the following code (note that <code>sp_vim</code> returns VIM estimates for all features):</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="kw">all_vim_spvim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sp_vim.html">sp_vim</a></span>(Y = <span class="kw">heart</span><span class="op">$</span><span class="kw">chd</span>, X = <span class="kw">heart</span>[, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span>(<span class="kw">heart</span>)], SL.library = <span class="kw">learners.2</span>, na.rm = <span class="fl">TRUE</span>, env = <span class="fu"><a href="https://rdrr.io/r/base/environment.html">environment</a></span>(), V = <span class="kw">V</span>, cvControl = <span class="kw">sl_cvcontrol</span>)
<span class="co">#&gt; Warning in sp_vim(Y = heart$chd, X = heart[, -ncol(heart)], SL.library =</span>
<span class="co">#&gt; learners.2, : One or more original estimates &lt; 0; returning zero for these</span>
<span class="co">#&gt; indices.</span>
</pre></div>
</div>
<div id="adjusting-for-confounders" class="section level2">
<h2 class="hasAnchor">
<a href="#adjusting-for-confounders" class="anchor"></a>Adjusting for confounders</h2>
<p>In some cases, there may be confounding factors that you want to adjust for in all cases. For example, in HIV vaccine studies, we often adjust for baseline demographic variables, including age and behavioral factors. If this is the case, then the null predictiveness above can be modified to be <span class="math inline">\(V(f_{0,c}, P_0)\)</span>, where <span class="math inline">\(c\)</span> is the index set of all confounders.</p>
</div>
<div id="conclusion" class="section level2">
<h2 class="hasAnchor">
<a href="#conclusion" class="anchor"></a>Conclusion</h2>
<p>The three VIMs defined here may be different for a given feature of interest. Indeed, we can see this for family history of heart disease in the South African heart disease study data:</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="kw">fam_vim_cond</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; cv_vim(Y = Y, X = X, f1 = f1, f2 = f2, indx = indx, V = V, folds = folds, </span>
<span class="co">#&gt;     stratified = stratified, weights = weights, type = "r_squared", </span>
<span class="co">#&gt;     run_regression = run_regression, SL.library = SL.library, </span>
<span class="co">#&gt;     alpha = alpha, delta = delta, na.rm = na.rm, env = ..1, cvControl = ..2)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Variable importance estimates:</span>
<span class="co">#&gt;       Estimate SE         95% CI         VIMP &gt; 0 p-value  </span>
<span class="co">#&gt; s = 5 0        0.06931241 [0, 0.1358498] FALSE    0.8312363</span>
<span class="kw">fam_vim_marg</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; cv_vim(Y = Y, X = X, f1 = f1, f2 = f2, indx = indx, V = V, folds = folds, </span>
<span class="co">#&gt;     stratified = stratified, weights = weights, type = "r_squared", </span>
<span class="co">#&gt;     run_regression = run_regression, SL.library = SL.library, </span>
<span class="co">#&gt;     alpha = alpha, delta = delta, na.rm = na.rm, env = ..1, cvControl = ..2)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Variable importance estimates:</span>
<span class="co">#&gt;       Estimate   SE         95% CI         VIMP &gt; 0 p-value  </span>
<span class="co">#&gt; s = 1 0.08166248 0.07062743 [0, 0.2200897] FALSE    0.1515939</span>
<span class="co"># note: need to look at row for s = 5</span>
<span class="kw">all_vim_spvim</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; sp_vim(Y = heart$chd, X = heart[, -ncol(heart)], V = V, SL.library = learners.2, </span>
<span class="co">#&gt;     na.rm = TRUE, env = environment(), cvControl = sl_cvcontrol)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Variable importance estimates:</span>
<span class="co">#&gt;       Estimate    SE         95% CI                   VIMP &gt; 0 p-value   </span>
<span class="co">#&gt; s = 1 0.004516890 0.02954330 [0.00000000, 0.06242069] FALSE    0.50827470</span>
<span class="co">#&gt; s = 2 0.055048445 0.03955769 [0.00000000, 0.13258009] FALSE    0.23544526</span>
<span class="co">#&gt; s = 3 0.036119072 0.03624313 [0.00000000, 0.10715430] FALSE    0.32411383</span>
<span class="co">#&gt; s = 4 0.000000000 0.03819597 [0.00000000, 0.07486272] FALSE    0.53438175</span>
<span class="co">#&gt; s = 5 0.121111996 0.03697624 [0.04863989, 0.19358410]  TRUE    0.04220225</span>
<span class="co">#&gt; s = 6 0.016592155 0.02534898 [0.00000000, 0.06627525] FALSE    0.43010076</span>
<span class="co">#&gt; s = 7 0.000000000 0.04415103 [0.00000000, 0.08653443] FALSE    0.53267210</span>
<span class="co">#&gt; s = 8 0.008849874 0.02565153 [0.00000000, 0.05912596] FALSE    0.48030366</span>
<span class="co">#&gt; s = 9 0.068934488 0.03846287 [0.00000000, 0.14432033] FALSE    0.17540507</span>
</pre></div>
<p>This is simply a function of the fact that the VIMs are different population parameters. All three likely provide useful information in practice:</p>
<ul>
<li>the marginal VIM provides information about the predictiveness of the covariate in isolation;</li>
<li>the conditional VIM provides information about the predictiveness of the covariate adjusting for all other covariates; and</li>
<li>the SPVIM provides information about the predictiveness of the covariate averaged over all sets of adjustment variables.</li>
</ul>
<p>To choose a VIM, identify which of these three (there may be more than one) that best addresses your scientific question.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Brian D. Williamson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
